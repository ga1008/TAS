<form id="createForm" class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8 bg-white relative animate-fade-in-up">

    <div class="md:col-span-2 space-y-2">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">
            <i class="fas fa-tag mr-1 text-indigo-500"></i> 核心名称
        </label>
        <div class="relative">
            <input type="text" name="task_name" required placeholder="例如：2026年春季期末-Java程序设计"
                   value="{{ ref_task['name'] + ' (Regenerated)' if ref_task else '' }}"
                   class="w-full bg-slate-50 border border-slate-200 text-slate-700 rounded-xl px-4 py-3.5 focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-4 focus:ring-indigo-500/10 transition-all shadow-sm font-medium">
        </div>
    </div>

    <div class="md:col-span-2 space-y-2">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">
            <i class="fas fa-book mr-1 text-indigo-500"></i> 课程名称
        </label>
        <div class="relative">
            <input type="text" name="course_name" required placeholder="例如：数据结构与算法"
                   value="{{ ref_task['course_name'] if ref_task else '' }}"
                   class="w-full bg-slate-50 border border-slate-200 text-slate-700 rounded-xl px-4 py-3.5 focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-4 focus:ring-indigo-500/10 transition-all shadow-sm font-medium">
        </div>
    </div>

    <div class="md:col-span-1 space-y-2">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">试卷满分</label>
        <div class="relative">
            <input type="number" name="max_score" required value="{{ ref_task['max_score'] if ref_task else '100' }}"
                   class="w-full bg-slate-50 border border-slate-200 text-slate-700 rounded-xl pl-4 pr-12 py-3.5 focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-4 focus:ring-indigo-500/10 transition-all font-mono font-bold">
            <span class="absolute right-4 top-3.5 text-slate-400 text-xs font-bold pt-1">分</span>
        </div>
    </div>

    <div class="md:col-span-1 space-y-2">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">批改严格度</label>
        <div class="grid grid-cols-3 gap-3">
            <label class="cursor-pointer group">
                <input type="radio" name="strictness" value="loose" class="peer sr-only" {% if ref_task and ref_task['strictness'] == 'loose' %}checked{% endif %}>
                <div class="border border-slate-200 rounded-xl p-3 text-center bg-slate-50 hover:bg-emerald-50 hover:border-emerald-200 peer-checked:bg-emerald-500 peer-checked:border-emerald-500 peer-checked:text-white peer-checked:shadow-md transition-all">
                    <div class="font-bold text-xs">宽松</div>
                </div>
            </label>
            <label class="cursor-pointer group">
                <input type="radio" name="strictness" value="standard" class="peer sr-only" {% if not ref_task or ref_task['strictness'] == 'standard' %}checked{% endif %}>
                <div class="border border-slate-200 rounded-xl p-3 text-center bg-slate-50 hover:bg-indigo-50 hover:border-indigo-200 peer-checked:bg-indigo-600 peer-checked:border-indigo-600 peer-checked:text-white peer-checked:shadow-md transition-all">
                    <div class="font-bold text-xs">标准</div>
                </div>
            </label>
            <label class="cursor-pointer group">
                <input type="radio" name="strictness" value="strict" class="peer sr-only" {% if ref_task and ref_task['strictness'] == 'strict' %}checked{% endif %}>
                <div class="border border-slate-200 rounded-xl p-3 text-center bg-slate-50 hover:bg-rose-50 hover:border-rose-200 peer-checked:bg-rose-500 peer-checked:border-rose-500 peer-checked:text-white peer-checked:shadow-md transition-all">
                    <div class="font-bold text-xs">严格</div>
                </div>
            </label>
        </div>
    </div>

    {% if ref_task %}
        <div class="md:col-span-2 bg-indigo-50 border border-indigo-100 rounded-2xl p-5 flex items-start gap-4">
            <div class="w-10 h-10 rounded-xl bg-white text-indigo-600 flex items-center justify-center shrink-0 shadow-sm">
                <i class="fas fa-history"></i>
            </div>
            <div>
                <h3 class="font-bold text-indigo-900 text-sm">已继承历史素材</h3>
                <p class="text-xs text-indigo-700/70 mt-1">
                    正在复用任务 <span class="font-mono bg-white px-1.5 rounded text-indigo-600 border border-indigo-100">{{ ref_task['id'] }}</span> 的文件。
                </p>
            </div>
        </div>
    {% else %}
        <div class="md:col-span-1 flex flex-col space-y-3">
            <div class="flex justify-between items-center px-1">
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">上传试卷文档</label>
                <a href="/file_manager" target="_blank" class="text-[10px] font-bold text-indigo-500 bg-indigo-50 px-2.5 py-1 rounded-full border border-indigo-100 hover:bg-indigo-100 hover:border-indigo-200 transition-all flex items-center shadow-sm group">
                    <i class="fas fa-external-link-alt mr-1 group-hover:scale-110 transition-transform"></i> 库管理
                </a>
            </div>
            <div id="drop-exam" onclick="openFileModal('exam')" class="border-2 border-dashed border-slate-200 rounded-2xl p-6 bg-slate-50/50 hover:bg-white hover:border-indigo-300 transition-all cursor-pointer relative group flex flex-col items-center justify-center min-h-[140px]">
                <input type="hidden" name="exam_file_id" id="exam_file_id">
                <div id="exam-display" class="flex flex-col items-center pointer-events-none transition-transform group-hover:scale-105 duration-300">
                    <div class="w-12 h-12 rounded-full bg-white shadow-sm border border-slate-100 flex items-center justify-center mb-3 group-hover:shadow-md transition-all">
                        <i class="fas fa-file-code text-xl text-slate-300 group-hover:text-indigo-500 transition-colors"></i>
                    </div>
                    <p class="text-xs font-bold text-slate-600 mb-1">点击选择试卷</p>
                    <p class="text-[10px] text-slate-400">AI 将编写 Python 脚本</p>
                </div>
            </div>
        </div>

        <div class="md:col-span-1 flex flex-col space-y-3">
            <div class="flex justify-between items-center px-1">
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">上传评分标准</label>
                <a href="/file_manager" target="_blank" class="text-[10px] font-bold text-indigo-500 bg-indigo-50 px-2.5 py-1 rounded-full border border-indigo-100 hover:bg-indigo-100 hover:border-indigo-200 transition-all flex items-center shadow-sm group">
                    <i class="fas fa-external-link-alt mr-1 group-hover:scale-110 transition-transform"></i> 库管理
                </a>
            </div>
            <div id="drop-std" onclick="openFileModal('std')" class="border-2 border-dashed border-slate-200 rounded-2xl p-6 bg-slate-50/50 hover:bg-white hover:border-indigo-300 transition-all cursor-pointer relative group flex flex-col items-center justify-center min-h-[140px]">
                <input type="hidden" name="standard_file_id" id="standard_file_id">
                <div id="std-display" class="flex flex-col items-center pointer-events-none transition-transform group-hover:scale-105 duration-300">
                    <div class="w-12 h-12 rounded-full bg-white shadow-sm border border-slate-100 flex items-center justify-center mb-3 group-hover:shadow-md transition-all">
                        <i class="fas fa-list-ol text-xl text-slate-300 group-hover:text-indigo-500 transition-colors"></i>
                    </div>
                    <p class="text-xs font-bold text-slate-600 mb-1">点击选择评分标准</p>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="md:col-span-2 mt-6 pt-4 border-t border-slate-100">
        <button type="submit" id="btnSubmit" class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-slate-900 hover:shadow-xl transition-all flex items-center justify-center gap-2 transform active:scale-95 duration-200">
            <i class="fas fa-magic text-indigo-400"></i>
            {{ '开始重新生成' if ref_task else '开始生成核心' }}
        </button>
    </div>
</form>