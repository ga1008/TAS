<form id="createForm" class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8 bg-white relative">

    <div class="md:col-span-2 space-y-1.5">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">
            核心名称 <span class="text-indigo-500">*</span>
        </label>
        <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                <i class="fas fa-tag"></i>
            </div>
            <input type="text" name="task_name" required placeholder="例如：2026年春季期末-Java程序设计"
                   value="{{ ref_task['name'] + ' (Regenerated)' if ref_task else '' }}"
                   class="w-full bg-slate-50 border border-slate-200 text-slate-700 rounded-xl pl-10 pr-4 py-3.5 focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-4 focus:ring-indigo-500/10 transition-all shadow-sm">
        </div>
    </div>

    <div class="md:col-span-1 space-y-1.5">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">
            试卷满分
        </label>
        <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                <i class="fas fa-trophy"></i>
            </div>
            <input type="number" name="max_score" required value="{{ ref_task['max_score'] if ref_task else '100' }}"
                   class="w-full bg-slate-50 border border-slate-200 text-slate-700 rounded-xl pl-10 pr-12 py-3.5 focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-4 focus:ring-indigo-500/10 transition-all font-mono font-bold">
            <span class="absolute right-4 top-3.5 text-slate-400 text-sm font-medium">分</span>
        </div>
    </div>

    <div class="md:col-span-1 space-y-1.5">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">批改严格度</label>
        <div class="grid grid-cols-3 gap-3">
            <label class="cursor-pointer group">
                <input type="radio" name="strictness" value="loose" class="peer sr-only" {% if ref_task and ref_task['strictness'] == 'loose' %}checked{% endif %}>
                <div class="border border-slate-200 rounded-xl p-3 text-center bg-slate-50 hover:bg-emerald-50 hover:border-emerald-200 peer-checked:bg-emerald-500 peer-checked:border-emerald-500 peer-checked:text-white peer-checked:shadow-md transition-all h-full flex flex-col justify-center">
                    <div class="font-bold text-sm">宽松</div>
                    <div class="text-[10px] opacity-60 mt-0.5">捞分模式</div>
                </div>
            </label>
            <label class="cursor-pointer group">
                <input type="radio" name="strictness" value="standard" class="peer sr-only" {% if not ref_task or ref_task['strictness'] == 'standard' %}checked{% endif %}>
                <div class="border border-slate-200 rounded-xl p-3 text-center bg-slate-50 hover:bg-indigo-50 hover:border-indigo-200 peer-checked:bg-indigo-600 peer-checked:border-indigo-600 peer-checked:text-white peer-checked:shadow-md transition-all h-full flex flex-col justify-center">
                    <div class="font-bold text-sm">标准</div>
                    <div class="text-[10px] opacity-60 mt-0.5">平衡模式</div>
                </div>
            </label>
            <label class="cursor-pointer group">
                <input type="radio" name="strictness" value="strict" class="peer sr-only" {% if ref_task and ref_task['strictness'] == 'strict' %}checked{% endif %}>
                <div class="border border-slate-200 rounded-xl p-3 text-center bg-slate-50 hover:bg-rose-50 hover:border-rose-200 peer-checked:bg-rose-500 peer-checked:border-rose-500 peer-checked:text-white peer-checked:shadow-md transition-all h-full flex flex-col justify-center">
                    <div class="font-bold text-sm">严格</div>
                    <div class="text-[10px] opacity-60 mt-0.5">严谨模式</div>
                </div>
            </label>
        </div>
    </div>

    {% if ref_task %}
        <div class="md:col-span-2 bg-indigo-50/50 border border-indigo-100 rounded-xl p-6 flex items-center gap-4">
            <div class="w-10 h-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0">
                <i class="fas fa-history"></i>
            </div>
            <div>
                <h3 class="font-bold text-indigo-900 text-sm">继承历史文件</h3>
                <p class="text-xs text-indigo-700/80 leading-relaxed mt-1">
                    系统将自动复用原任务 <span class="font-mono bg-white px-1 rounded border border-indigo-100">{{ ref_task['id'] }}</span> 的试卷和评分标准。
                    无需重新上传，您只需修改下方的生成指令即可优化结果。
                </p>
            </div>
        </div>
    {% else %}
        <div class="md:col-span-1 flex flex-col space-y-2">
            <div class="flex justify-between items-center px-1">
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">选择试卷文档</label>
                <div class="flex items-center gap-3">
                    <button type="button" onclick="openFileModal('exam')" class="text-[10px] text-indigo-500 hover:text-indigo-600 font-bold transition flex items-center gap-1">
                        <i class="fas fa-folder-open"></i> 选择
                    </button>
                    <a href="/file_manager" class="text-[10px] text-slate-400 hover:text-slate-600 font-bold transition flex items-center gap-1 hover:underline ml-1">
                        <i class="fas fa-file-invoice"></i> 管理
                    </a>
                </div>
            </div>

            <div id="exam-card" class="border border-dashed border-slate-200 rounded-xl p-5 bg-slate-50 flex items-center justify-between gap-4">
                <div id="exam-display" class="flex items-center gap-3 text-slate-400">
                    <div class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center">
                        <i class="fas fa-file-alt text-lg"></i>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-slate-600">尚未选择试卷</p>
                        <p class="text-[10px] text-slate-400">从文档解析管理器选择已上传文件</p>
                    </div>
                </div>
                <i class="fas fa-arrow-right text-slate-300 text-sm"></i>
            </div>
            <input type="hidden" name="exam_file_id" id="exam_file_id">
        </div>

        <div class="md:col-span-1 flex flex-col space-y-2">
            <div class="flex justify-between items-center px-1">
                <label class="text-xs font-bold text-slate-500 uppercase tracking-wider">选择评分标准</label>
                <div class="flex items-center gap-3">
                    <button type="button" onclick="openFileModal('std')" class="text-[10px] text-indigo-500 hover:text-indigo-600 font-bold transition flex items-center gap-1">
                        <i class="fas fa-folder-open"></i> 选择
                    </button>
                    <a href="/file_manager" class="text-[10px] text-slate-400 hover:text-slate-600 font-bold transition flex items-center gap-1 hover:underline ml-1">
                        <i class="fas fa-file-invoice"></i> 管理
                    </a>
                </div>
            </div>

            <div id="std-card" class="border border-dashed border-slate-200 rounded-xl p-5 bg-slate-50 flex items-center justify-between gap-4">
                <div id="std-display" class="flex items-center gap-3 text-slate-400">
                    <div class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center">
                        <i class="fas fa-clipboard-check text-lg"></i>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-slate-600">尚未选择评分标准</p>
                        <p class="text-[10px] text-slate-400">请选择已解析的评分标准文件</p>
                    </div>
                </div>
                <i class="fas fa-arrow-right text-slate-300 text-sm"></i>
            </div>
            <input type="hidden" name="standard_file_id" id="standard_file_id">
        </div>
    {% endif %}

    <div class="md:col-span-2 flex flex-col space-y-1.5">
        <label class="block text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">
            额外 Prompt 指令 <span class="text-slate-400 font-normal normal-case">(可选)</span>
        </label>
        <div class="relative">
            <textarea name="extra_desc" placeholder="告诉 AI 具体的评分偏好，例如：&#10;1. 如果代码没有注释，强制扣5分。&#10;2. 文件名匹配失败时，尝试查找 .txt 后缀。"
                      class="w-full h-48 bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm text-slate-700 focus:outline-none focus:bg-white focus:border-indigo-400 focus:ring-4 focus:ring-indigo-500/10 transition-all resize-none leading-relaxed shadow-inner">{{ ref_task['extra_desc'] if ref_task else '' }}</textarea>

            <div class="absolute bottom-3 right-3 text-slate-300 text-xs pointer-events-none">
                <i class="fas fa-keyboard"></i>
            </div>
        </div>
    </div>

    <input type="hidden" name="ref_task_id" value="{{ ref_task['id'] if ref_task else '' }}">

    <div class="md:col-span-2 pt-4 border-t border-slate-100 mt-2">
        <button type="submit" id="btnSubmit" class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-slate-900 hover:shadow-xl transition-all flex items-center justify-center gap-2 transform active:scale-95 duration-200">
            <i class="fas fa-magic text-indigo-400"></i>
            {{ '开始重新生成' if ref_task else '开始生成核心' }}
        </button>
    </div>
</form>
