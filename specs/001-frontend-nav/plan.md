# Implementation Plan: 前端导航架构重构

**Branch**: `001-frontend-nav` | **Date**: 2025-01-21 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-frontend-nav/spec.md`

## Summary

本功能旨在重构系统前端导航架构，将原有的班级列表首页迁移到独立的批改任务页面，新建仪表盘首页作为系统入口，并规范化侧边栏菜单和上下文相关的顶栏设计。

核心变更：
1. 新建仪表盘首页 (`/`)：显示统计概览、快捷操作入口、最近活动
2. 批改任务页面 (`/tasks`)：原首页内容迁移至此
3. 重构侧边栏菜单：按功能区域重新组织
4. 上下文相关顶栏：根据页面动态显示操作按钮
5. 面包屑导航：深层级页面添加面包屑

## Technical Context

**Language/Version**: Python 3.8+ (Flask 2.x), HTML5 + JavaScript (ES6+)
**Primary Dependencies**: Flask, Jinja2, Tailwind CSS (CDN), jQuery 3.7, Bootstrap 5
**Storage**: SQLite (现有数据库，无需新增表结构)
**Testing**: 手动测试为主，现有系统无自动化测试
**Target Platform**: Web 浏览器 (Chrome, Firefox, Safari, Edge 最新版本)
**Project Type**: Web 应用 (Flask 后端 + Jinja2 模板前端)
**Performance Goals**: 仪表盘 3 秒内加载完成，统计数据会话级缓存
**Constraints**: 必须遵循 `templates/FRONTEND_GUIDE.md` 设计规范，保持 SPA 无刷新导航体验
**Scale/Scope**: 单用户系统，预计 10-50 个班级，500-2000 名学生

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Verify compliance with `.specify/memory/constitution.md`:

- [x] **模块化解耦**: 新增 `dashboard.html` 模板，在 `blueprints/main.py` 添加路由，依赖关系单向（蓝图 → 服务层）
- [x] **微服务分离**: 本功能仅涉及前端导航，不涉及 AI 微服务
- [x] **前端设计一致性**: 严格遵循 `templates/FRONTEND_GUIDE.md`，使用 Tailwind 配置、毛玻璃效果、FontAwesome 图标
- [x] **批改器可扩展性**: 本功能不涉及批改逻辑
- [x] **数据库迁移友好**: 统计数据使用现有 API，无需新增表结构
- [x] **AI 能力分层**: 本功能不涉及 AI 调用

## Project Structure

### Documentation (this feature)

```text
specs/001-frontend-nav/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
autoCorrecting/
├── blueprints/
│   ├── main.py          # 修改：新增 /tasks 路由，修改 / 路由
├── services/
│   └── stats_service.py # 新增：统计数据聚合服务
├── templates/
│   ├── base.html        # 修改：侧边栏菜单重构、顶栏组件化
│   ├── dashboard.html   # 新增：仪表盘首页模板
│   ├── tasks.html       # 新增：批改任务列表模板（原 index.html 内容）
│   └── components/
│       ├── topbar/
│       │   ├── base_topbar.html      # 新增：顶栏基础组件
│       │   ├── dashboard_topbar.html # 新增：仪表盘顶栏
│       │   ├── tasks_topbar.html     # 新增：批改任务顶栏
│       │   └── grading_topbar.html   # 新增：批改详情顶栏（含面包屑）
│       └── stats/
│           ├── stat_card.html        # 新增：统计卡片组件
│           ├── quick_action.html     # 新增：快捷操作入口组件
│           └── activity_item.html    # 新增：活动条目组件
└── static/
    └── js/
        └── context_topbar.js # 新增：顶栏上下文管理脚本
```

**Structure Decision**: 这是一个 Flask Web 应用，使用 Jinja2 模板引擎。前端采用 SPA 架构（通过 `spa_router.js` 实现无刷新导航），所有模板共享 `base.html` 基础布局。本功能主要涉及模板层和少量路由调整，不涉及数据库结构变更。

## Complexity Tracking

> **No violations requiring justification**

本功能完全遵循项目宪法要求：
- 前端设计严格遵循 `FRONTEND_GUIDE.md`
- 模块职责清晰（stats_service 封装统计逻辑）
- 无循环依赖
- 无需数据库迁移（使用现有数据）

---

## Phase 0: Research

### Research Tasks

1. **现有 SPA 路由机制研究**
   - 分析 `static/js/spa_router.js` 的实现
   - 了解如何注册新路由
   - 确认路由切换时的事件处理

2. **统计数据源分析**
   - 确认班级总数、学生总数、批改核心数量的获取方式
   - 分析 `database.py` 中相关查询方法
   - 确定待处理任务数的计算逻辑

3. **组件化策略**
   - 研究现有模板的复用方式
   - 确定 Jinja2 组件（include/macro）的最佳实践
   - 设计顶栏组件的复用模式

---

## Phase 1: Design

### Data Model

参见 [data-model.md](./data-model.md)

### API Contracts

参见 [contracts/api.md](./contracts/api.md)

### Quickstart Guide

参见 [quickstart.md](./quickstart.md)

---

## Phase 2: Tasks (Generated by /speckit.tasks)

本阶段由 `/speckit.tasks` 命令生成具体任务列表。
