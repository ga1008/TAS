# Feature Specification: 侧边栏与顶栏导航系统重构

**Feature Branch**: `001-navbar-refactor`
**Created**: 2026-01-22
**Status**: Draft
**Input**: 用户描述: "重构侧边菜单栏和顶栏系统，解决页面切换后功能失常的问题，统一顶栏按钮设计"

## Clarifications

### Session 2026-01-22

- Q: 当用户快速连续点击不同菜单项时，系统如何处理并发请求？ → A: 防抖处理（取消前一个请求，只处理最后一次点击）
- Q: 当页面加载失败时，系统如何处理？ → A: 显示Toast错误提示，保留当前页面不变，用户可重新点击菜单
- Q: 用户有未保存数据时导航离开，是否需要警告？ → A: 不需要警告，直接导航

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 菜单导航功能正常 (Priority: P1)

教师通过侧边菜单栏点击不同功能模块时，目标页面应完整加载并正常工作，所有页面功能（按钮点击、表单提交、数据刷新等）均可正常响应。

**Why this priority**: 这是系统的核心导航功能，如果导航后页面功能失常，用户将无法正常使用系统的任何功能，直接影响系统可用性。

**Independent Test**: 从首页通过侧边菜单依次访问所有功能页，验证每个页面的核心功能是否可用。

**Acceptance Scenarios**:

1. **Given** 用户在首页, **When** 点击侧边菜单"批改任务"链接, **Then** 批改任务页面完整加载，任务卡片可点击进入详情，"新建批改任务"按钮可正常响应。

2. **Given** 用户在批改任务页面, **When** 点击侧边菜单"生成核心"链接, **Then** AI生成页面完整加载，Tab切换、文件选择、表单提交等所有交互功能均可正常使用。

3. **Given** 用户在任意功能页, **When** 点击侧边菜单中的任意其他链接, **Then** 目标页面完整加载，不出现"函数未定义"等JavaScript错误。

4. **Given** 用户在任意功能页, **When** 使用浏览器后退/前进按钮, **Then** 页面正确显示且功能完整可用。

---

### User Story 2 - 顶栏导航与快捷操作 (Priority: P2)

顶栏应提供统一的导航功能（返回、首页）以及当前页面的上下文快捷操作按钮，不同页面的顶栏按钮根据页面功能动态变化。

**Why this priority**: 顶栏是用户操作的主要入口之一，统一的设计可提升用户体验和操作效率，但相比核心导航功能，优先级略低。

**Independent Test**: 访问不同功能页面，验证顶栏按钮是否与当前页面功能匹配。

**Acceptance Scenarios**:

1. **Given** 用户在"批改任务"页面, **When** 查看顶栏, **Then** 显示"新建批改任务"快捷按钮以及通知中心图标。

2. **Given** 用户在"生成核心"页面, **When** 查看顶栏, **Then** 显示"文档解析管理"和"查看核心列表"快捷按钮。

3. **Given** 用户在"首页/仪表盘"页面, **When** 查看顶栏, **Then** 显示"刷新数据"按钮以及通知中心。

4. **Given** 用户在任意功能页, **When** 点击顶栏"返回"按钮, **Then** 返回上一个访问的页面，页面功能正常。

5. **Given** 用户在任意功能页, **When** 点击顶栏"首页"按钮, **Then** 跳转至首页/仪表盘，页面功能正常。

---

### User Story 3 - 视觉一致性与交互反馈 (Priority: P3)

侧边栏和顶栏的视觉设计应遵循现有前端设计规范，提供流畅的过渡动画和清晰的交互反馈。

**Why this priority**: 视觉一致性是用户体验的重要组成部分，但在功能正确性之后考虑。

**Independent Test**: 视觉检查侧边栏和顶栏在不同页面的呈现效果。

**Acceptance Scenarios**:

1. **Given** 用户在任意页面, **When** 查看侧边菜单, **Then** 当前页面对应的菜单项应有明显的"激活"高亮样式。

2. **Given** 用户点击菜单项, **When** 页面切换过程中, **Then** 应显示加载指示器（进度条或旋转图标）。

3. **Given** 用户鼠标悬停在菜单项或按钮上, **When** 观察视觉变化, **Then** 应有平滑的颜色/位移过渡动画。

4. **Given** 用户在任意页面, **When** 查看顶栏按钮样式, **Then** 所有顶栏按钮应使用一致的样式（.btn-glass 玻璃按钮风格）。

---

### Edge Cases

- **EC-001 网络延迟处理**: 当网络延迟较高时，显示加载指示器（FR-017已覆盖）。
- **EC-002 快速连续点击**: 采用防抖处理策略——取消前一个请求，只处理最后一次点击，确保用户看到最终目标页面。
- **EC-003 页面加载失败**: 显示Toast错误提示，保留当前页面不变，用户可重新点击菜单重试。
- **EC-004 未保存数据警告**: 不需要警告，直接导航（系统操作多为即时提交，无长时间编辑状态）。

## Requirements *(mandatory)*

### Functional Requirements

#### 核心导航功能

- **FR-001**: 系统 MUST 确保通过侧边菜单或顶栏导航到任意页面后，该页面的所有JavaScript功能完整可用（包括按钮点击、表单提交、AJAX请求等）。

- **FR-002**: 系统 MUST 确保浏览器的后退/前进功能正常工作，且导航后的页面功能完整。

- **FR-003**: 侧边菜单 MUST 在所有功能页面保持可见且功能一致，与页面内容区域完全独立。

- **FR-004**: 顶栏 MUST 在所有功能页面保持可见，包含统一的"返回"和"首页"按钮。

#### 顶栏动态内容

- **FR-005**: 顶栏 MUST 根据当前页面动态显示与该页面相关的快捷操作按钮。

- **FR-006**: 每个功能页面 MUST 可以定义其特有的顶栏快捷按钮（0-3个按钮）。

- **FR-007**: 顶栏快捷按钮 MUST 遵循统一的样式规范（玻璃按��风格：白色背景、浅灰边框、悬停时变色）。

#### 各页面顶栏按钮规划

- **FR-008**: 首页/仪表盘顶栏 MUST 包含："刷新数据"按钮、AI欢迎语组件（紧凑版）、通知中心。

- **FR-009**: 批改任务页顶栏 MUST 包含：页面标题、"新建批改任务"按钮、通知中心。

- **FR-010**: 生成核心页顶栏 MUST 包含：页面标题、"文档解析管理"链接、"核心列表"链接。

- **FR-011**: 核心列表页顶栏 MUST 包含：页面标题、"生成新核心"链接、"批量操作"按钮（如有）。

- **FR-012**: 班级学生页顶栏 MUST 包含：页面标题、"导入学生"按钮、"新建班级"按钮。

- **FR-013**: 教学文档页顶栏 MUST 包含：页面标题、"上传文档"按钮。

- **FR-014**: 文档解析页顶栏 MUST 包含：页面标题、"返回文档库"链接。

- **FR-015**: 教务系统页顶栏 MUST 包含：页面标题、"同步数据"按钮（如已连接）。

#### 视觉与交互

- **FR-016**: 侧边菜单 MUST 高亮显示当前所在页面对应的菜单项（使用active样式）。

- **FR-017**: 页面切换时 MUST 显示加载指示器，防止用户误以为点击无效。

- **FR-018**: 所有菜单项和按钮 MUST 有悬停状态的视觉反馈（颜色变化、位移动画）。

- **FR-019**: 侧边栏和顶栏 MUST 遵循项目前端设计规范（FRONTEND_GUIDE.md）中定义的色彩、圆角、阴影等样式。

#### 功能保留

- **FR-020**: 重构后 MUST 保留所有现有页面的原有功能，不得遗漏或破坏任何已实现的功能。

- **FR-021**: 侧边菜单 MUST 保留现有的菜单分类结构（概览、批改管理、AI工具、资源管理、系统）。

- **FR-022**: 管理员入口 MUST 保留现有的弹窗登录验证机制。

### Key Entities

- **NavigationItem**: 导航菜单项，包含：图标、标题、目标URL、所属分类、是否需要特殊权限

- **TopbarAction**: 顶栏快捷按钮，包含：图标、标题、点击动作（URL或JavaScript函数）、样式变体

- **PageContext**: 页面上下文，包含：页面标识符、页面标题、顶栏按钮配置

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 通过侧边菜单访问任意功能页后，该页面的所有核心功能测试用例100%通过。

- **SC-002**: 使用浏览器后退/前进按钮导航时，目标页面功能测试用例100%通过。

- **SC-003**: 所有功能页的顶栏按钮与该页面功能相匹配，无空白顶栏或不相关按钮的情况。

- **SC-004**: 页面切换过程用户感知延迟不超过500ms（网络正常情况下）。

- **SC-005**: 在Chrome DevTools控制台中，页面切换后无JavaScript错误（如"xxx is not defined"）。

- **SC-006**: 侧边栏当前页面菜单项高亮正确率100%。

## Assumptions

1. **现有页面功能完整**：假设在传统全页刷新模式下，所有现有页面功能均可正常工作。

2. **浏览器兼容性**：目标浏览器为现代浏览器（Chrome、Firefox、Edge最新版本），不考虑IE兼容。

3. **无离线支持需求**：系统需要网络连接才能使用，不需要支持离线模式。

4. **前端技术栈保持不变**：继续使用Jinja2模板、Tailwind CSS、jQuery/原生JavaScript，不引入Vue/React等框架。

## Out of Scope

1. 移动端响应式侧边栏折叠功能（保持现有行为）
2. 侧边栏菜单项的拖拽排序功能
3. 用户自定义顶栏按钮功能
4. 多语言/国际化支持
5. 键盘快捷键导航
